\documentclass[]{article}
\usepackage[pdftex]{graphicx}
\usepackage[top=1in, bottom=1in, right=1.25in, left=1.25in]{geometry}
\usepackage{hyperref}
\usepackage{float}
\hypersetup{colorlinks=true, linkcolor=blue, urlcolor=blue}

\begin{document}
\title{Work Log for Colin Madigan}
\date{}
\maketitle
	\tableofcontents

	%Sixteenth Entry
	\section{Dividing Images, Whiteboard Color Normalization (11/1/2012)}
	\subsection*{Dividing Images into Cells}
		I changed the cell division so that the cell images are put into a two-dimensional array.  Now, the image cells are located spatially in the same place as the images they represent in the picture.  This should make it easier to reference and operate on specific parts of the image.  I also needed a new way to demonstrate the changes that I can make on individual cells.  I used a two for loops (one for each dimension), and one uses modulo division to determine even or odd cells.
		
		\subsection*{Whiteboard Color Normalization}
		Now that we can break images into cells, we need to be able to extract the whiteboard color, and normalize the whiteboard color so that it is uniform across the entire board.  I started by attempting to follow the strategy laid out in Microsoft's paper.  Their method was to take the luminance of every cell image and apply a histogram to obtain the most common color value in each cell.  Then, create a cell with that color value and fill the new image with cells of the whiteboard colors.  A sample of the code I wrote is below:

\begin{verbatim}
for i in nsize:
    for j in nsize:
        lum[i][j] = cell_image[i][j].convert("L")
        hist[i][j] = lum[i][j].histogram()
        big[i][j] = max(hist[i][j])
        white[i][j] = hist[i][j].index(big[i][j])
        wb[i][j] = Image.new("L",(cell_width,cell_height),white[i][j])
        bkgd[i][j] = wb[i][j].convert("RGB")
        im_new.paste(bkgd[i][j], cell[i][j])
im_new.show()
\end{verbatim}

\begin{figure}[H]
\centering
\includegraphics[scale=1]{images/whiteboard_cropped}
\caption{The whiteboard image seen in figure \ref{fig:whiteboard} (from 10/29 work log), cropped so that only the board content is displayed}
\label{fig:whiteboard_cropped}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[scale=0.25]{images/wb_crop_background_1}
\caption{A 21 by 21 cell image with the whiteboard color extracted}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[scale=0.25]{images/wb_crop_background_2}
\caption{A 41 by 41 cell image with the whiteboard color extracted}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[scale=0.25]{images/wb_background}
\caption{The whiteboard image from figure \ref{fig:whiteboard}, processed by the code seen above.}
\end{figure}

This image demonstrates that the normalization of the cell images may be useful for more than just whiteboard color normalization.  The edges of the whiteboard are very defined, and may be useful for edge detection.

	%Fifteenth Entry
	\section{Post Panel 2, Dividing Images into Cells (10/29/2012)}
	Note:  I have not yet received a response from anyone involved with the Microsoft project.  If I don't hear back by this week's senior design meeting, I will talk to MST and/or Dr. Watkins about using their contacts.
		\subsection*{Post Panel 2}
	Our panel meeting went well - we updated everyone present on our progress, and received some good feedback about our plans going forward.  Bill from the CTDI group suggested that we look into Image Magic (related to J Magic) for image processing applications.  He said it works with Java or Python, so we will have to at least look at it.  
		\subsection*{Dividing Images into Cells}
	I was able to take an image and divide it into cells.  Right now, I can divide it arbitrarily into  cells, though in the final project we will choose the number of cells to be a size that is relevant to the size of content on the board.  \\
	To divide the image into cells, I wrote a script that divides the image width and height into $n$ segments, then goes through and creates $n^2$ cells from the image.  Each cell can then be individually modified.
	
\begin{verbatim}
import Image
import ImageEnhance

im = Image.open("whiteboard.jpg")
width=im.size[0]
height=im.size[1]
n=5
cell_width=width/n
cell_height=height/n
cell = (n**2)*[0]
cell_image = (n**2)*[0]
x=0

for i in range(0,n):
    for j in range(1,n+1):
        cell[x]= ((j-1)*cell_width, i*cell_height, j*cell_width, (i+1)*cell_height)
        cell_image[x] = im.crop(cell[x])
        x=x+1
\end{verbatim}
	
This code will divide an image into 25 cells.  To illustrate this, consider the image below.

\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{images/whiteboard}
\caption{A typical whiteboard. Source: Google Images}
\label{fig:whiteboard}
\end{figure}	

Now, consider the image is divided into cells using the above process. If no operations are done on it, the image looks identical to the original.  Below is the same image, with a brightness filter applied to every other cell.

\begin{figure}[H]
\centering
\includegraphics[scale=0.15]{images/cell_brightness_5}
\end{figure}	

The following code was used to create this image: 
\begin{verbatim}
checkered = range(0,n**2,2)

for i in checkered:
    temp = ImageEnhance.Brightness(cell_image[i])
    temp = temp.enhance(2.0)
    im.paste(temp, cell[i])
im.show()
\end{verbatim}

This can be scaled to any $n$ value, as seen below, but with a contrast filter.

\begin{figure}[H]
\centering
\includegraphics[scale=0.15]{images/cell_contrast_25}
\end{figure}


	%Fourteenth Entry
	\section{Gantt Chart, Preparation for Faculty Panel 2 (10/24/2012)}
		\subsection*{Gantt Chart}
	I finished the Gantt chart.  I ended up using an online Gantt chart program (\url{tomsplanner.com}).  It is easy to use and looks nice... the only disadvantage is that I can't export it without a paid membership.  For now I'm just screen-capturing it.  I plan on switching the chart to Microsoft Project in the future.
		\subsection*{Panel 2}
	The Gantt chart is ready to go, and I used the information from the chart to update our schedule document, which is essentially a narrowed-down text version of the Gantt chart.  
	
	%Thirteenth Entry
	\section{Microsoft, Gantt Chart, Learning Python (10/20/2012)}
		\subsection*{Contacting Microsoft}
	I sent an email to the three people listed on the WCS paper explaining to them what we are trying to accomplish, and asking if they could give us any help via access to parts of their work.  I am waiting for a response.
		\subsection*{Gantt chart}	
	I am in charge of making the Gantt chart for our group. I am looking into different free options for chart creation. I found something that templates a Gantt chart in Excel, but it doesn't look very good and I'm looking for something better.  As far as assigning tasks, we have talked about it as a group, so people are working on tasks that are most suited to their skills and interests.  Griffin is doing a lot of the work towards identifying a camera, and Phil and I are looking to start doing image processing.
		\subsection*{Python}
	I'm still working through lessons on Codecademy.  Mainly, they teach the syntax of Python: The importance of white space, math operations, loops, etc...  They have been helpful so far, but soon I'll just need to jump in to our task and learn the relevant parts as I go.  
	%Twelvth Entry
	\section{Risk Meeting, Tasks Going Forward (10/18/2012)}
		\subsection*{Meeting with Prof. Thompson}
	Today we met with Prof. Thompson about our risk analysis.  I think now we better understand what is expected of us going forward this semester.  We should focus more on proving that certain concepts will work, not necessarily implementing them as we will in our project.  For example, we should see how to do basic relevant image processing using libraries for Java, C++, Python, etc... and compare the processes.  
		\subsection*{Individual tasks going forward}	
	Going forward, I first need to contact Microsoft Research to try and acquire the source code from the WCS.  This will hopefully simplify the image processing aspect of our project, since we could use their code as a guideline for our own, or possibly even use entire chunks of their code in our implementation. \\
	\indent Currently, we need to make a Gantt chart for our semester schedule.  Then I will look into various aspects of image processing and come up with demos to demonstrate progress.  Currently I'm trying to learn Python from \url{codecademy.com}, since background research suggested that it may be the easiest language for the tasks we're trying to complete.
	
	
	%Eleventh Entry
	\section{Risk Analysis (10/16/2012)}
		\subsection*{Risk}	
	In class last week, we worked on risk analysis and planning. Here is the list I came up with of possible risks and their level of risk:
	\begin{itemize} \itemsep -2pt
	\item \textbf{HIGH -} What language/framework to use?
	\item \textbf{HIGH -} Specific image processing libraries?
	\item \textbf{HIGH -} What camera? Android compatible? (Nikon, Samsung)?
	\item \textbf{HIGH -} How to interface camera with computer?
	\item \textbf{HIGH -} Wireless syncing?
	\item \textbf{MEDIUM -} Database for images? How to add to it from camera
	\item \textbf{LOW -} Can students access photos directly?
	\item \textbf{LOW -} How to distribute images? Dropbox? Netspace? Email?
	\item \textbf{LOW -} Does the camera need a stand?
	\item \textbf{MEDIUM -} Adjusting for capture angle (second edition)
	\item \textbf{MEDIUM -} Automatic recognition of board area
	\item \textbf{MEDIUM -} Key frames: only right before erase (like WCS)?
	\item \textbf{LOW -} Manual frame capture option
	\item \textbf{MEDIUM -} Filters for students w/ learning disorders
	\end{itemize}		
	
	Possible Demos: 
	\begin{itemize}
	\item Image noise removal 
	\item Identify person in image
	\item Remove person/replace with another image
	\item Rapid automatic image capture
	\end{itemize}
	
		\subsection*{Idea}
	During class I thought of a possible idea for filtering images on the whiteboard by color and content.  All board content could be displayed as a 3D matrix, as in the Microsoft system.  However, we could take it a step further and filter by color as well, since professors will sometimes write groups of related information in the same color. This is definitely true for civil engineering professors, based on notes provided to us by our client. \\
\begin{figure}[H]
\centering
\includegraphics[scale=0.4]{images/3D_matrix}
\caption{Idea similar to this image}
\end{figure}	
	\indent The board could be represented by a matrix of cell images, with the width and height representing the board dimensions, and the depth ``in and out'' of the board representing different groupings.  For instance, the whiteboard cells could all be in the same plane of the matrix, while any foreground (undesirable) objects could be in another plane. The rest of the board content could be in other planes, sorted by color. So for instance, all black writing would be in a particular plane, while blue writing would be in another.  By default, the processed image would remove foreground objects and display whiteboard and all writing, but the user could manually choose to only see, for instance, writing and drawings in red, or everything except green.  This feature could be useful to students with learning disabilities, since it would simplify the image and group relevant information together.




	% Tenth Entry
	\section{Final Version of Background Document (10/12/2012)}
	We uploaded our final version of the Background document to our git repo tonight.  (Speaking of that, our ProPANE site now links to the git hub for all documents, so we don't have to worry about changing that on the site every time.)  I added in all my research about signal processing, including code libraries, basic image processing concepts, and various image processing techniques that can be utilized.  We figured out some hitches with git so that we could successfully merge our separate changes into one document.  \\ \\

I did some more research into the Nikon COOLPIX s800c camera.  It is the only Android-powered camera currently on the market.  I found that it is theoretically available in-store at the Target in Selinsgrove, so I plan on driving down there some time soon to check it out in person.  


	% Ninth Entry	
	\section{Work on Background Document, Use of git for Document Version Control (10/9/2012)}
	\subsection*{Background Research}
	I am doing basic research on the field of signal processing, and specifically image processing.  A lot of it is simply looking for reliable sources to cite and take information from.  As far as code libraries go, there are A LOT of different image processing libraries out there for a plethora of different platforms.  I am trying to mainly look at ones that are either free, or that Bucknell has access to (MATLAB and Mathematica).  Speaking of those two, I found a great chart comparing them: \url{http://en.wikipedia.org/wiki/Comparison_of_image_processing_software} 

	\subsection*{git}
	We decided to use git for version control.  I made an account on github and cloned our repository to my system.  Now, we can all access the same files at all times. This is especially helpful for compiling LaTeX documents, since embedded images must be included in the directory, and any of us might add those.  





	% Eighth Entry
	\section{Third Client Meeting (10/5/2012)}
	We met with our clients and Prof. Thompson following our faculty panel.  We discussed some ideas that will help our project, and Prof. Thompson gave us some important feedback and suggestions.

\begin{itemize}
\item We need to touch on non-performance specs in our tech specifications: 
	\begin{itemize} \itemsep -2pt
	\item Wired vs. Wi-Fi
	\item skewing
	\item color
	\item saturation
	\item flash
	\end{itemize}
\item We should email Dr. Midkiff about the setup of classrooms on campus, especially the new Academic West area.
\item Include option for a manual key frame capture
\end{itemize}
	
\textbf{Information for our background document: }
\begin{itemize}
\item Take a hierarchical approach 
\item Provide reasons for researching products
	\begin{itemize} \itemsep -2pt
	\item Why do they benefit us 
	\item Why are they grouped as such in document?
	\end{itemize}
\item Explain why the WCS is so important
\item Include research on signal processing
	\begin{itemize} \itemsep -2pt
	\item Look for code libraries that perform image processing
	\item General Concepts and points of interest regarding signal processing
	\end{itemize}
\item Look into applicable learning disabilities - what students need and why
\end{itemize}
	% Seventh Entry
	\section{Panel Feedback, Continued Research (9/30/2012)}
	Following the first faculty panel, we received some feedback that we will follow up with.
\begin{itemize}
\item We should contact Microsoft Research about getting any of the code used for their Whiteboard Capture System
\item Our capture system will need a capture device (obviously).  We should look into a smart camera by Nikon that runs Android, as well as a Samsung Galaxy camera that we previously found.  
\item We should assume that for our system, the distance from the board is constant.  We need to determine what that should be.  
\item We need information about the desired resolution of our camera.  
\end{itemize}

	% Sixth Entry
	\section{First Panel, Continued Research (9/27/2012)}
	I created an agenda for our first panel, and I got the specs and background documents together so each attendee could have one.  \\ \\
I am continuing background research into related technologies.  Currently, I'm looking at ReBoard, a whiteboard system who's greatest strength is its ability to sort captured data by a lot of different metadata. Info can be found \href{http://arxiv.org/ftp/arxiv/papers/0911/0911.0039.pdf}{here}.

	% Fifth Entry 
	\section{Additional Information on Microsoft Whiteboard Capture System (9/21/2012)}
	The research on the Microsoft Whiteboard Capture System (WCS) is done, and will be included in our Background and Research document.  I talked in detail about that system's method of capturing data and processing it.  The paper gave many mathematical examples on how they accomplished certain steps of their system, but I did not include them in the research document, so I will discuss them here.
	\subsection*{Clustering Cell Images Over Time}
	As the meeting progresses, the WCS groups cell images from the same cell together if it determines that they don't change over a period of time.  This is done using a modified Normalized Cross-Correlation algorithm to determine if two cells are the same or different.  It is demonstrated here for one color, but applies to all RGB components.  \\
Consider two cell images $I$ and $I'$.  Let $\bar{I}$ and $\bar{I'}$ be their mean colors and $\sigma$ and $\sigma'$ be their standard deviations.  The normalized cross-correlation score is given by \[ c={1 \over N \sigma \sigma'} \sum (I_i - \bar{I})(I_i' - \bar{I'}) \]
where the summation is over every pixel $i$ and $N$ is the total number of pixels.  The score ranges from -1, for two images not similar at all, to 1, for two identical images.  Since the score is computed after the subtraction of the mean color, it may still give a high value even if two images have very different mean colors.  So a different test is performed on the mean color difference, based on the Mahalanobis distance \href{http://en.wikipedia.org/wiki/Mahalanobis_distance}{(info)}.  The distance is given by 
\[ d={|\bar{I}-\bar{I'}| \over (\sigma + \sigma')} \]
Two cells are considered to be identical and are grouped together if and only if $d<T_d$ and $c>T_c$.  In the WCS implementation, $T_d=2$ and $T_c=0.707$.
	\subsection*{Classifying Cells}
It must be determined whether a cell image is a whiteboard, stroke, or foreground object.  The determination is based on whether or not a cell's color distribution is the same, similar, or very different from that of the whiteboard.  As above, the Mahalanobis distance is used, and calculations are for one component of RGB.  \\
\indent Let $\bar{I}_w$ be the whiteboard color and $\sigma_w$ be the standard deviation (small since a whiteboard cell is basically uniform).  Then let $\bar{I}$ and $\sigma$ be the mean and standard deviation of the current cell image.  The cell image is classified as a whiteboard cell if and only if \[ {|\bar{I} - \bar{I}_w| \over (\sigma + \sigma_w)}<T_w \quad \textrm{ and } \quad  {\sigma \over \sigma_w }< T_\sigma \] 
and as a stroke cell if and only if
\[{|\bar{I}-\bar{I}_w| \over (\sigma + \sigma_w)}<T_w \quad \textrm{ and } \quad {\sigma \over \sigma_w} \geq T_\sigma \] 
Otherwise, it's classified as a foreground object cell.  In the WCS implementation, $T_w=2$ and $T_\sigma=2$.
	\subsection*{Key frame color balance}
The background must be uniformly color-balanced and the color saturation of the pen strokes must be increased.  The previously-calculated whiteboard color, $\bar{I}_w$ is used to scale the color of each pixel in the cell. \[ I_{out} = \textrm{min} (255, {I_{in} \over I_w} \cdot 255) \]
Image noise is reduced by remapping the value of each color channel of each pixel in the key frames according to an S-shaped curve.

	% Fourth Entry
	\section{Review of Second Client Meeting, Background Research (9/17/2012)}

		\subsection*{9/13 Meeting Review}
Met with Dr. Midkiff and Dr. Gabauer regarding our technical specifications.  They made a couple of suggestions for modification of our specs (bold numbers refer to tech spec section numbers):
\begin{itemize}
\item \textbf{3.1.2} Setup time can be longer than our suggested 5 minutes if it's a one time process (or once daily) and the settings can be saved for multiple uses. Active vs. passive setup time is important.
\item \textbf{3.3.2} Key frames should be time-stamped
\item \textbf{6.2.2} User should be able to select other frames as ``key frames'' if he/she is not happy with the automatically chosen frames
\item \textbf{7.1} Transfer from professor to student \textbf{must} be easy to use.  Ideas include email or a dropbox feature. \\  
\indent Notes must be delivered to students within 24 hours.  Therefore, all captured data should be in the hands of the professor well before then. \newline
\hspace{0.1in} End-users (students) should be able to edit images as well. Suggested features include zoom in/out, viewing of frames preceding and following key frames.  \sl{These may be included in Version 2}
\end{itemize}
		\subsection*{Continuing research}
I am finalizing a section of research on the Microsoft Whiteboard Capture System mentioned in the work log on 9/5.  I am also starting research on another system, the ReBoard, as mentioned \href{http://www.fxpal.com/publications/FXPAL-PR-10-546.pdf}{here} and \href{http://www.fxpal.com/?p=reboard}{here}.  
		

	% Third Entry
	\section{Tech Specs, Second Meeting, Website Design (9/11/2012)}

		\subsection*{Technical Specification Document}
		Worked with Phil on the first draft of the Specification and Testing document \href{https://docs.google.com/viewer?a=v&pid=sites&srcid=ZGVmYXVsdGRvbWFpbnxidXByb3BhbmV8Z3g6NjhkOWVjMjIyZjY3ZTM4ZA}{(link)}.  We outlined general areas that we need to have specifications for, including hardware, software, interface, and legal requirements.  We are not far enough along with research to begin making specific declarations regarding most technical areas, but we outlined what we will need to define in the future.  Additional details regarding specs will also be outlined in our upcoming meeting with our clients.

		\subsection*{Second Client Meeting}
		I arranged a meeting with Dr. Gabauer and Dr. Midkiff for 3 pm on 9/13/12 \href{https://docs.google.com/viewer?a=v&pid=sites&srcid=ZGVmYXVsdGRvbWFpbnxidXByb3BhbmV8Z3g6NDMwMGY4NTlmYWQ2NjUx}{(agenda here)}.  I arranged a conference room in Dana through Judy of the EE department.  We are meeting about the technical specifications of our project.  Dr. Midkiff will provide crucial input on the legal requirements we face due to designing a device for special needs students.  Dr. Gabaur's input will help us better understand the scope of the design and whiteboard capture process. The meeting will also help us prioritize the features of the first version of the product.

		\subsection*{ProPANE Site Changes}
		I made one small change to the website.  The homepage was extremely empty (prior to the project description being there) so I designed and added a graphic to fill space, while also helping viewers to understand our project at such an early stage.  It attracts the reader's attention with appropriately-colored text, it explains the ProPANE acronym, and it includes our logo.  This graphic is seen below.

\begin{figure}[H]
\centering
\includegraphics[scale=0.36]{images/propane_whiteboard}
\caption{Homepage image}
\end{figure}
 

	% Second Entry
	\section{Logo Design, Research on Background and Competition  (09/05/2012)}

		\subsection*{Logo Design}
		Worked on the ProPANE logo.  Tried different color schemes ranging anywhere from black and white, orange and blue (Bucknell) and black and gold.  Design was done in Adobe Photoshop and MS Paint.

\begin{figure}[H]
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[scale=0.22]{images/logo_options}
\caption{Preliminary logo designs}
\end{minipage}
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[scale=0.7]{images/ProPANE_final_logos}
\caption{Current ProPANE logos}
\end{minipage}
\end{figure}

Eventually the group settled on the current logos above, because they are easy on the eyes yet they still stand out.  \\

		\subsection*{Background Research}
			We began researching the different existing technologies that meet standards similar to that of our project.  One in particular seemed very similar to the design we are aiming for: a research project by Microsoft, their Whiteboard Capture System \href{ftp://ftp.research.microsoft.com/pub/tr/tr-2002-89.pdf}{(link)}.  I am in charge of analyzing it for inclusion in our Project Background and Research document.  

The Whiteboard Capture System is portable, works on any whiteboard, and provides a method of data distribution, all of which are desirable for our system.  However, it has some shortcomings (does not work on blackboards) and possible excess features (audio recording and playback).  Full  analysis will be included in the final document.    \\
			
			
			
	
	% First Entry
	\section{First Group Meeting and General Group Information  (08/31/2012)}
		
		Talked about the Initial Group Tasks.  Came up with a name, logo, and document template.  Discussed general tech specs and background information.    
		
		\subsection*{Technical Specifications}
			Our end design must be a portable system which captures notes written on a chalkboard or whiteboard, and distributes the information for later use.  We are looking into similar products which are currently on the market for background info and implementation ideas.  Dr. Midkiff plans to use our system to aid students with disabilities, so extra attention must be paid to ease of use and clarity of the final deliverable product.      \\
		
		\subsection*{Team Name and Logo}
			We wated to come up with an acronym that was both relevant to our project in some way, and also easy to say. We settled on the name BU ProPANE, which stands for \textbf{Pro}fessional \textbf{P}ortable \textbf{A}utomatic \textbf{N}ote  \textbf{E}xtraction.  We liked the idea of an already well-known word for the name, and we decided to design a logo with the same theme.  I am currently working with an image of a propane molecule to design a logo for BU ProPANE.    \\
			
		\subsection*{Document Template}
			We are using \LaTeX to format our documents and deliverables.  It was chosen because it takes care of formatting for us.   \\
			

\end{document}